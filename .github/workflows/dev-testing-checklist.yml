name: Dev testing checklist

on:
  pull_request_target:
    types:
      - opened

permissions:
  contents: read
  pull-requests: read
  issues: read

jobs:
  add-checklist-comment:
    runs-on: ubuntu-latest

    steps:
      - name: Post dev testing checklist as comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.BOT_COMMENT_TOKEN }}
          script: |
            const lines = [
              '### R-Instat developer checklist',
              '',
              '1. **Basic functionality - "Does it work?"**',
              '- [ ] Runs without errors on a dataset',
              '- [ ] Outputs created correctly (data frames, graphs, summaries, models, etc.)',
              '- [ ] Results appear in the right places (e.g., output window)',
              '',
              '2. **TestOK / OK button behaviour**',
              '- [ ] OK disabled when dialog is incomplete/invalid',
              '- [ ] OK enabled only when required inputs are set correctly',
              '- [ ] TestOk updates when different controls change',
              '',
              '3. **UI behaviour**',
              '- [ ] Reset returns dialog to defaults and TestOk updates',
              '- [ ] Cancel/Close makes no changes to data or outputs',
              '- [ ] Controls show/hide/enable/disable/clear correctly when options change',
              '',
              '4. **Edge cases & error handling**',
              '- [ ] Invalid inputs (e.g. negative, too-large, empty, impossible combos) handled cleanly',
              '- [ ] Running dialog twice with different parameters behaves consistently (e.g., Press OK, reopen, change controls, press OK again)',
              '- [ ] Tested on different size data sets.',
              '',
              '5. **Resolved AI Comments**',
              '- [ ] All AI/bot review comments have been read',
              '- [ ] Each comment has been addressed (code changed) or intentionally ignored with a short explanation',
              '- [ ] No unresolved AI comments that you still plan to act on',
              '- [ ] Anything unclear has been asked about in the PR discussion'
            ];

            const body = lines.join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body
            });
